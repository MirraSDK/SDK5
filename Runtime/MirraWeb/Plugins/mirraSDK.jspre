(()=>{var a=class s{static{this.contentPrefix="%cmirraSDK.js%c"}static{this.prefixStyle="background: #c29a46; color: #3c3c3c; border-radius: 3px; padding: 0px 5px;"}static{this.contentStyle="color: inherit"}static{this.enableTextMessages=!0}static{this.enableWarningMessages=!0}static{this.enableExceptionMessages=!0}static createText(...e){s.enableTextMessages&&console.log(this.contentPrefix,this.prefixStyle,this.contentStyle,...e)}static createWarning(...e){s.enableWarningMessages&&console.warn(this.contentPrefix,this.prefixStyle,this.contentStyle,...e)}static createError(...e){s.enableExceptionMessages&&console.error(this.contentPrefix,this.prefixStyle,this.contentStyle,...e)}};var Z=class{constructor(){this.dataAdClient="";this.dataAdChannel="";this.dataAdBreakTest=!1;this.interstitialIntervalSeconds=0}},C=class s{constructor(){this.logger=new s.Logger;this.crazyGames=new s.CrazyGames;this.y8=new s.Y8;this.gameDistribution=new s.GameDistribution;this.lagged=new s.Lagged;this.yandexGames=new s.YandexGames;this.vk=new s.VK;this.ok=new s.OK;this.gamePix=new s.GamePix;this.poki=new s.Poki;this.coolMath=new s.CoolMath;this.playDeck=new s.PlayDeck}static{this.Logger=class{constructor(){this.enableTextMessages=!0;this.enableWarningMessages=!0;this.enableExceptionMessages=!0}}}static{this.CrazyGames=class{constructor(){this.getUserToken=!1;this.interstitialIntervalSeconds=0}}}static{this.Y8=class{constructor(){this.adSense=new Z}}}static{this.GameDistribution=class{constructor(){this.gameId="";this.adsDebug=!1;this.adsAutoplay=!1;this.adsLocale="en";this.interstitialIntervalSeconds=0}}}static{this.Lagged=class{constructor(){this.devId="";this.publisherId="";this.interstitialIntervalSeconds=0}}}static{this.YandexGames=class{constructor(){this.interstitialIntervalSeconds=0}}}static{this.VK=class{constructor(){this.appId="";this.extraArgs="";this.interstitialIntervalSeconds=0}}}static{this.OK=class{constructor(){this.extraArgs="";this.interstitialIntervalSeconds=0}}}static{this.GamePix=class{constructor(){this.interstitialIntervalSeconds=0}}}static{this.Poki=class{constructor(){this.interstitialIntervalSeconds=0}}}static{this.CoolMath=class{constructor(){this.interstitialIntervalSeconds=0}}}static{this.PlayDeck=class{constructor(){this.interstitialIntervalSeconds=0}}}};var L=class{constructor(e,t){this.delegate=e,this.isDisposable=t}};var m=class{constructor(){this.delegates=[]}add(e,t=!1){this.delegates.push(new L(e,t))}remove(e){let t=this.delegates.findIndex(r=>r.delegate===e);t!==-1&&this.delegates.splice(t,1)}clear(e=!1){e?this.delegates=this.delegates.filter(t=>!t.isDisposable):this.delegates=[]}invoke(...e){let t=0;for(;t<this.delegates.length;){let r=this.delegates[t];r.delegate(...e),r.isDisposable?this.delegates.splice(t,1):t++}}};var d=class{constructor(){this.isBannerAvailable=!1;this.isBannerVisible=!1;this.isBannerReady=!1;this.onBannerOpen=new m;this.onBannerClose=new m;this.onBannerError=new m;this.isInterstitialAvailable=!1;this.isInterstitialVisible=!1;this.isInterstitialReady=!1;this.interstitialIntervalSeconds=0;this.onInterstitialOpen=new m;this.onInterstitialClose=new m;this.onInterstitialError=new m;this.isRewardedAvailable=!1;this.isRewardedVisible=!1;this.isRewardedReady=!1;this.onRewardedOpen=new m;this.onRewardedClose=new m;this.onRewardedError=new m;this.onBannerOpen.add(()=>{a.createText("onBannerOpen"),this.isBannerVisible=!0}),this.onBannerClose.add(()=>{a.createText("onBannerClose"),this.isBannerVisible=!1}),this.onBannerError.add(e=>{a.createError("onBannerError",e)}),this.onInterstitialOpen.add(()=>{a.createText("onInterstitialOpen"),this.isInterstitialVisible=!0}),this.onInterstitialClose.add(e=>{a.createText("onInterstitialClose"),this.isInterstitialVisible=!1,e&&(this.lastInterstitialSuccess=new Date)}),this.onInterstitialError.add(e=>{a.createError("onInterstitialError",e)}),this.onRewardedOpen.add(()=>{a.createText("onRewardedOpen"),this.isRewardedVisible=!0}),this.onRewardedClose.add(e=>{a.createText("onRewardedClose",e.toString()),this.isRewardedVisible=!1,e&&(this.lastRewardedSuccess=new Date)}),this.onRewardedError.add(e=>{a.createError("onRewardedError",e)})}async initialize(){}async invokeBanner(){a.createText("invokeBanner");try{this.invokeBannerImpl()}catch(e){this.onBannerError.invoke(e)}}async refreshBanner(){a.createText("refreshBanner");try{this.refreshBannerImpl()}catch(e){this.onBannerError.invoke(e)}}async disableBanner(){a.createText("disableBanner");try{this.disableBannerImpl()}catch(e){this.onBannerError.invoke(e)}}async invokeInterstitial(e,t){if(a.createText("invokeInterstitial"),this.isInterstitialVisible||this.isRewardedVisible){a.createError("ad already visible"),t(!1);return}if(this.lastInterstitialSuccess){let i=(new Date().getTime()-this.lastInterstitialSuccess.getTime())/1e3;if(i<this.interstitialIntervalSeconds){let n=this.interstitialIntervalSeconds-i;a.createText("interstitial skipped",n.toString(),"seconds until interval"),t(!1);return}}this.onInterstitialOpen.clear(!0),this.onInterstitialClose.clear(!0),this.onInterstitialOpen.add(e,!0),this.onInterstitialClose.add(t,!0);try{await this.invokeInterstitialImpl()}catch(r){a.createError("invokeInterstitial error",r),this.onInterstitialError.invoke(r),this.onInterstitialClose.invoke(!1)}}async invokeRewarded(e,t){if(a.createText("invokeRewarded"),this.isInterstitialVisible||this.isRewardedVisible){a.createError("ad already visible"),t(!1);return}this.onRewardedOpen.clear(!0),this.onRewardedClose.clear(!0),this.onRewardedOpen.add(e,!0),this.onRewardedClose.add(t,!0);try{await this.invokeRewardedImpl()}catch(r){a.createError("invokeRewarded error",r),this.onRewardedError.invoke(r),this.onRewardedClose.invoke(!1)}}};var p=class s{static createScript(e,t,r,i=!1,n="",l={}){try{let u=document.createElement("script");u.src=e,u.onload=t,u.onerror=r,u.async=i,u.id=n;for(let[y,P]of Object.entries(l))u.setAttribute(y,P);document.body.appendChild(u)}catch(u){a.createError("createScript",u)}}static createScriptAsync(e,t="",r={}){return new Promise((i,n)=>{s.createScript(e,i,n,!0,t,r)})}};var h=class{constructor(){this.isGameplayStarted=!1;this.gameplayLevel=0;this.isGameplayPaused=!1;this.intendedGameplayStarted=!1;this.isGameReadyCalled=!1}async initialize(){K.pause.onAdsPauseChange.add(e=>{this.isGameplayPaused=e,e?this.isGameplayStarted&&(this.gameplayStopImpl(this.gameplayLevel),this.isGameplayStarted=!1):this.intendedGameplayStarted&&(this.gameplayStartImpl(this.gameplayLevel),this.isGameplayStarted=!0)})}gameIsReady(){if(this.isGameReadyCalled){a.createText("gameIsReady already called");return}a.createText("gameIsReady");try{this.gameIsReadyImpl(),this.isGameReadyCalled=!0}catch(e){a.createError(e)}}gameplayStart(e=0){a.createText("gameplayStart",e.toString());try{this.intendedGameplayStarted=!0,this.gameplayLevel=e,!this.isGameplayPaused&&!this.isGameplayStarted&&(this.gameplayStartImpl(this.gameplayLevel),this.isGameplayStarted=!0)}catch(t){a.createError(t)}}gameplayRestart(e=0){a.createText("gameplayRestart",e.toString());try{let t=e||this.gameplayLevel;this.gameplayRestartImpl(t),this.isGameplayStarted=!0,this.intendedGameplayStarted=!0}catch(t){a.createError(t)}}gameplayStop(e=0){a.createText("gameplayStop",e.toString());try{this.intendedGameplayStarted=!1,this.gameplayLevel=e,!this.isGameplayPaused&&this.isGameplayStarted&&(this.gameplayStopImpl(this.gameplayLevel),this.isGameplayStarted=!1)}catch(t){a.createError(t)}}};var o=class{static async createInstance(e,...t){if(typeof e!="function"||!e.prototype)throw new Error("invalid constructor");let r=new e(...t);return typeof r.initialize=="function"&&await r.initialize(),r}};var B=class s{static async createInstance(e){s.settings=e;let t=new s;try{s.checkDomains(),await p.createScriptAsync("https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"),await p.createScriptAsync("https://www.coolmathgames.com/sites/default/files/cmg-ads.js"),t.ads=await o.createInstance(s.Ads,window),t.analytics=await o.createInstance(s.Analytics,parent)}catch(r){a.createError(r)}return t}static checkDomains(){let e=["https://www.coolmathgames.com","www.coolmathgames.com","https://edit.coolmathgames.com","edit.coolmathgames.com","www.stage.coolmathgames.com","stage-edit.coolmathgames.com","https://dev.coolmathgames.com","https://www.stage.coolmathgames.com","https://stage-edit.coolmathgames.com","https://dev.coolmathgames.com","https://dev-edit.coolmathgames.com"],t=window.location.href;e.some(i=>t.includes(i))||(parent!=null?parent.document.location="https://www.coolmathgames.com":document.location="https://www.coolmathgames.com")}static{this.Ads=class extends d{constructor(t){super();this.isRewardedAd=!1;this.SDK=t}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0,document.addEventListener("adBreakStart",()=>{this.isRewardedAd==!0?this.onRewardedOpen.invoke():this.onInterstitialOpen.invoke()}),document.addEventListener("adBreakComplete",()=>{this.isRewardedAd==!0?this.onRewardedClose.invoke(!0):this.onInterstitialClose.invoke(!0)})}async invokeBannerImpl(){throw new Error("not implemented")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){throw new Error("not implemented")}async invokeInterstitialImpl(){this.isRewardedAd=!1,this.SDK.cmgAdBreak()}async invokeRewardedImpl(){this.isRewardedAd=!0,this.SDK.cmgRewardsAdBreak()}}}static{this.Analytics=class extends h{constructor(e){super(),this.SDK=e}gameIsReadyImpl(){this.SDK.cmgGameEvent("start")}gameplayStartImpl(e){this.SDK.cmgGameEvent("start",e)}gameplayRestartImpl(e){this.SDK.cmgGameEvent("replay",e)}gameplayStopImpl(e){this.SDK.cmgGameEvent("stop",e)}}}};var T=class{static async waitForDelay(e){return new Promise(t=>{setTimeout(()=>t(),e)})}};var f=class s{constructor(){this.jsonCache="{}";this.jsonObject={};this.isSaveRequested=!1;this.saveCheckDelay=3e3;this.isAutosaveEnabled=!0}async initialize(){await this.getFromServer(),this.startAutosave()}async startAutosave(){for(;this.isAutosaveEnabled;)this.isSaveRequested&&(await this.setToServer(),this.isSaveRequested=!1,await T.waitForDelay(this.saveCheckDelay)),await T.waitForDelay(100)}async stopAutosave(){this.isAutosaveEnabled=!1}async getFromServer(){a.createText("getFromServer"),this.jsonCache=await this.readServerJson();try{this.jsonCache?this.jsonObject=s.migrateJsonObject(this.jsonCache):this.jsonObject={}}catch(e){a.createError(e)}}async setToServer(){a.createText("setToServer");try{this.jsonObject.dataFormat="MirraSDK400";let e=JSON.stringify(this.jsonObject);if(this.jsonCache===e){a.createText("no changes to data");return}await this.writeServerJson(e)}catch(e){a.createError(e)}}static migrateJsonObject(e){let t={dataFormat:"MirraSDK400"},r;try{r=JSON.parse(e)}catch(l){return a.createError("json is invalid",l),t}if(r&&r.dataFormat=="MirraSDK400")return a.createText("both json and data format are valid"),r;a.createText("migrating json to MirraSDK400");function i(l){let u=atob(l),y=new Uint8Array(u.length);for(let v=0;v<u.length;v++)y[v]=u.charCodeAt(v);return new TextDecoder("utf-8").decode(y)}function n(l){let u=/^[A-Za-z0-9+/]*={0,2}$/;for(let y in l){if(!Object.prototype.hasOwnProperty.call(l,y))continue;let P=l[y];if(typeof P=="string"&&u.test(P)&&P.length%4===0)try{l[y]=i(P)}catch(v){console.warn(`Failed to decode '${P}':`,v)}}return l.dataFormat="MirraSDK400",l}return n(r)}get(e,t){return this.hasKey(e)?this.jsonObject[e]:t}set(e,t,r=!0){this.jsonObject[e]=t,r&&this.save()}save(){a.createText("save"),this.isSaveRequested=!0}hasKey(e){return typeof e!="string"||typeof this.jsonObject!="object"?!1:this.jsonObject[e]!==void 0}deleteKey(e,t=!0){this.hasKey(e)&&(delete this.jsonObject[e],t&&this.save())}deleteAll(){a.createWarning("deleteAll"),this.jsonObject={},this.save()}};var g=class{constructor(){this.displayName="";this.firstName="";this.lastName="";this.username="";this.uniqueId="";this.isLoggedIn=!1;this.onLoginSuccess=new m;this.onLoginError=new m;this.onLoginSuccess.add(()=>{a.createText("onLoginSuccess"),this.isLoggedIn=!0}),this.onLoginError.add(e=>{a.createError("onLoginError",e),this.isLoggedIn=!1})}async initialize(){await this.updatePlayerInfo()}async invokeLogin(e,t){a.createText("invokeLogin"),this.onLoginSuccess.add(e,!0),this.onLoginError.add(t,!0);try{if(this.isLoggedIn){a.createText("Already logged in"),this.onLoginSuccess.invoke();return}await this.tryLoginPlayer(),await this.updatePlayerInfo(),this.onLoginSuccess.invoke()}catch(r){this.onLoginError.invoke(r)}}};var I=class{constructor(){this.players=[]}};var w=class{async initialize(){}async happyTime(){a.createText("achievements.happyTime");try{await this.happyTimeImpl()}catch(e){a.createError("achievements.happyTime",e)}}async unlock(e){a.createText("achievements.unlock",e);try{await this.unlockImpl(e)}catch(t){a.createError("achievements.unlock",t)}}async getScore(e){a.createText("achievements.getScore",e);try{return await this.getScoreImpl(e)}catch(t){return a.createError("achievements.getScore",t),0}}async setScore(e,t){a.createText("achievements.setScore",e,t.toString());try{await this.setScoreImpl(e,t)}catch(r){a.createError("achievements.setScore",r)}}async getLeaderboard(e){a.createText("achievements.getLeaderboard",e);try{return await this.getLeaderboardImpl(e)}catch(t){return a.createError("achievements.getLeaderboard",t),new I}}};var j=class s{static async createInstance(e){s.settings=e;let t=new s;try{await p.createScriptAsync("https://sdk.crazygames.com/crazygames-sdk-v3.js"),t.SDK=window.CrazyGames.SDK,await t.SDK.init(),t.achievements=await o.createInstance(s.Achivements,t.SDK),t.ads=await o.createInstance(s.Ads,t.SDK),t.analytics=await o.createInstance(s.Analytics,t.SDK),t.data=await o.createInstance(s.Data,t.SDK),t.player=await o.createInstance(s.Player,t.SDK)}catch(r){a.createError(r)}return t}static{this.Achivements=class extends w{constructor(e){super(),this.SDK=e}async happyTimeImpl(){this.SDK.game.happytime()}async unlockImpl(e){throw new Error("not implemented")}async getScoreImpl(e){throw new Error("not implemented")}async setScoreImpl(e,t){throw new Error("not implemented")}async getLeaderboardImpl(e){throw new Error("not implemented")}}}static{this.Ads=class extends d{constructor(e){super(),this.SDK=e}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){throw new Error("not implemented")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){throw new Error("not implemented")}async invokeInterstitialImpl(){let e={adFinished:()=>{this.onInterstitialClose.invoke(!0)},adError:t=>{let r=JSON.stringify(t.message);if(this.onInterstitialError.invoke(r),/disabled during basic launch/.test(r)){a.createText("interstitial success on basic launch"),this.onInterstitialClose.invoke(!0);return}if(/requested too soon/.test(r)||/error playing ad/.test(r)||/Unknown message/.test(r)||/Unknown error/.test(r)||/AdBlock detected/.test(r)){this.onInterstitialClose.invoke(!1);return}},adStarted:()=>{this.onInterstitialOpen.invoke()}};this.SDK.ad.requestAd("midgame",e)}async invokeRewardedImpl(){let e={adFinished:()=>{this.onRewardedClose.invoke(!0)},adError:t=>{let r=JSON.stringify(t.message);if(this.onRewardedError.invoke(r),/disabled during basic launch/.test(r)){a.createText("rewarded success on basic launch"),this.onRewardedClose.invoke(!0);return}if(/requested too soon/.test(r)||/error playing ad/.test(r)||/Unknown message/.test(r)||/Unknown error/.test(r)||/AdBlock detected/.test(r)){this.onRewardedClose.invoke(!1);return}},adStarted:()=>{this.onRewardedOpen.invoke()}};this.SDK.ad.requestAd("rewarded",e)}}}static{this.Analytics=class extends h{constructor(e){super(),this.SDK=e}gameIsReadyImpl(){this.SDK.game.loadingStop()}gameplayStartImpl(e){this.SDK.game.gameplayStart()}gameplayRestartImpl(e){a.createText("not available")}gameplayStopImpl(e){this.SDK.game.gameplayStop()}}}static{this.Data=class extends f{constructor(t){super();this.jsonKey="json-data";this.SDK=t}async readServerJson(){try{return await this.SDK.data.getItem(this.jsonKey)||"{}"}catch(t){return a.createError(t),"{}"}}async writeServerJson(t){try{await this.SDK.data.setItem(this.jsonKey,t)}catch(r){a.createError(r)}}}}static{this.Player=class extends g{constructor(e){super(),this.SDK=e}async updatePlayerInfo(){try{let e=await this.SDK.user.getUser();e?(this.displayName=e.username,this.username=e.username,s.settings.getUserToken&&(this.uniqueId=await this.SDK.user.getUserToken()),this.isLoggedIn=!0):(this.displayName="Player",this.isLoggedIn=!1)}catch(e){a.createError(e)}}async tryLoginPlayer(){try{await this.SDK.user.showAuthPrompt()}catch(e){throw e}}}}};var k=(c=>(c[c.English=0]="English",c[c.Russian=1]="Russian",c[c.Japanese=2]="Japanese",c[c.Chinese=3]="Chinese",c[c.Turkish=4]="Turkish",c[c.Hindi=5]="Hindi",c[c.Korean=6]="Korean",c[c.Portuguese=7]="Portuguese",c[c.Indonesian=8]="Indonesian",c[c.German=9]="German",c[c.Spanish=10]="Spanish",c[c.Italian=11]="Italian",c[c.Ukrainian=12]="Ukrainian",c[c.Polish=13]="Polish",c[c.French=14]="French",c[c.Danish=15]="Danish",c[c.Czech=16]="Czech",c[c.Afrikaans=17]="Afrikaans",c[c.Icelandic=18]="Icelandic",c[c.Norwegian=19]="Norwegian",c[c.Swedish=20]="Swedish",c[c.Dutch=21]="Dutch",c[c.Slovak=22]="Slovak",c[c.Thai=23]="Thai",c[c.Vietnamese=24]="Vietnamese",c))(k||{});var O=class{constructor(){this.isMobile=!1;this.systemType="Unknown"}async initialize(){this.isMobile=await this.isMobileImpl(),this.systemType=await this.systemTypeImpl()}openUrl(e){a.createText("open url",e);try{this.openUrlImpl(e)}catch(t){a.createError(t)}}};var R=class{constructor(){this.jsonObject={}}async initialize(){await this.getFromServer()}async getFromServer(){a.createText("getFromServer");let e=await this.readServerJson();try{e?this.jsonObject=JSON.parse(e):this.jsonObject={}}catch(t){a.createError(t),this.jsonObject={}}}get(e,t){return this.hasKey(e)?this.jsonObject[e]:t}hasKey(e){return this.jsonObject[e]!==void 0}};var b=class{constructor(){this.current=0}async initialize(){this.current=await this.getCurrent()}};var S=class{constructor(){this.products=[];this.purchases=[];this.onPurchaseSuccess=new m;this.onPurchaseError=new m}async initialize(){this.onPurchaseSuccess.add(()=>{a.createText("onPurchaseSuccess")}),this.onPurchaseError.add(e=>{a.createText("onPurchaseError",e)}),await this.updateProducts(),await this.updatePurchases()}async updateProducts(){this.products=await this.getProductsFromServer(),a.createText("updateProducts",JSON.stringify(this.products))}async updatePurchases(){this.purchases=await this.getPurchasesFromServer(),a.createText("updatePurchases",JSON.stringify(this.purchases))}isProductPurchased(e){return this.purchases.includes(e)}getProductPrice(e){let t=this.products.find(r=>r.tag===e);return t?t.price:(a.createText("product not found",e),-1)}getProductCurrency(e){let t=this.products.find(r=>r.tag===e);return t?t.currency||"":(a.createText("product not found",e),"")}async purchase(e,t,r){a.createText("purchase",e),this.onPurchaseSuccess.add(t,!0),this.onPurchaseError.add(r,!0)}};var x=class{constructor(){this.current="Unknown";this.appId=""}async initialize(){this.current=D.detectPlatform(),this.appId=await this.getAppIdImpl()}async shareGame(e){a.createText("platform.shareGame");try{await this.shareGameImpl(e)}catch(t){a.createError("platform.shareGame",t)}}async rateGame(){a.createText("platform.rateGame");try{await this.rateGameImpl()}catch(e){a.createError("platform.rateGame",e)}}};var G=class s{static async createInstance(){let e=new s;try{e.ads=await o.createInstance(s.Ads),e.analytics=await o.createInstance(s.Analytics),e.data=await o.createInstance(s.Data),e.device=await o.createInstance(s.Device),e.flags=await o.createInstance(s.Flags),e.language=await o.createInstance(s.Language),e.payments=await o.createInstance(s.Payments),e.player=await o.createInstance(s.Player),e.achievements=await o.createInstance(s.Achievements),e.platform=await o.createInstance(s.Platform)}catch(t){a.createError(t)}return e}static{this.Ads=class extends d{async invokeBannerImpl(){a.createText("banner not available")}async refreshBannerImpl(){a.createText("banner not available")}async disableBannerImpl(){a.createText("banner not available")}async invokeInterstitialImpl(){a.createText("interstitial not available"),this.onInterstitialClose.invoke(!1)}async invokeRewardedImpl(){a.createText("rewarded not available"),this.onRewardedClose.invoke(!1)}}}static{this.Analytics=class extends h{gameIsReadyImpl(){a.createText("not available")}gameplayStartImpl(e){a.createText("not available")}gameplayRestartImpl(e){a.createText("not available")}gameplayStopImpl(e){a.createText("not available")}}}static{this.Data=class extends f{static{this.jsonKey="json-data"}static{this.databaseVersion=1}static{this.databaseName="mirraSDK"}static{this.storeName="mirraSDK_store"}async initialize(){s.Data.dbPromise||(s.Data.dbPromise=s.Data.openDatabase()),this.db=await s.Data.dbPromise}static async openDatabase(){return typeof indexedDB>"u"?null:new Promise((e,t)=>{let r=indexedDB.open(s.Data.databaseName,s.Data.databaseVersion);r.onupgradeneeded=i=>{let n=r.result;n.objectStoreNames.contains(s.Data.storeName)||n.createObjectStore(s.Data.storeName)},r.onsuccess=()=>{e(r.result)},r.onerror=()=>{t(r.error)}})}async readServerJson(){return this.db?new Promise((e,t)=>{try{let n=this.db.transaction([s.Data.storeName],"readonly").objectStore(s.Data.storeName).get(s.Data.jsonKey);n.onsuccess=()=>{let l=n.result;e(l!==void 0?l:"{}")},n.onerror=()=>{t(n.error)}}catch(r){t(r)}}):"{}"}async writeServerJson(e){if(this.db)return new Promise((t,r)=>{try{let l=this.db.transaction([s.Data.storeName],"readwrite").objectStore(s.Data.storeName).put(e,s.Data.jsonKey);l.onsuccess=()=>{a.createText("database write success"),t()},l.onerror=()=>{r(l.error)}}catch(i){r(i)}})}}}static{this.Device=class extends O{async isMobileImpl(){return typeof window>"u"||typeof navigator>"u"||typeof window.matchMedia>"u"?!1:window.matchMedia("(pointer: coarse)").matches}async systemTypeImpl(){let e=navigator.userAgent,t=[{regex:/android/i,type:"Android"},{regex:/iphone|ipad|ipod/i,type:"iOS"},{regex:/windows/i,type:"Windows"},{regex:/macintosh|mac/i,type:"Mac"},{regex:/linux/i,type:"Linux"}];for(let r of t)if(e.match(r.regex)){if(r.type==="Mac"){let i=await this.isMobileImpl();if("ontouchstart"in window&&navigator.maxTouchPoints>0)return"iOS";if(i)return"iOS"}return r.type}return"Unknown"}openUrlImpl(e){let t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}static{this.Flags=class extends R{async readServerJson(){return"{}"}}}static{this.Language=class extends b{getBrowserLanguage(){let e=navigator;return(e.language||e.userLanguage||e.browserLanguage||e.systemLanguage||"en-us").toLowerCase().split("-")[0]}async getCurrent(){try{if(typeof navigator>"u")return 0;switch(this.getBrowserLanguage()){case"en":return 0;case"ru":return 1;case"ja":return 2;case"zh":return 3;case"tr":return 4;case"hi":return 5;case"ko":return 6;case"pt":return 7;case"id":return 8;case"de":return 9;case"es":return 10;case"it":return 11;case"uk":return 12;case"pl":return 13;case"fr":return 14;case"da":return 15;case"cs":return 16;case"af":return 17;case"is":return 18;case"no":return 19;case"sv":return 20;case"nl":return 21;case"sk":return 22;case"th":return 23;case"vi":return 24;default:return 0}}catch(e){return a.createError("language detection failed",e),0}}}}static{this.Payments=class extends S{async getProductsFromServer(){return[]}async getPurchasesFromServer(){return[]}async purchase(e,t,r){super.purchase(e,t,r),this.onPurchaseError.invoke("not implemented")}}}static{this.Player=class extends g{async updatePlayerInfo(){}async tryLoginPlayer(){this.onLoginError.invoke("login not available")}}}static{this.Achievements=class extends w{async happyTimeImpl(){a.createText("achievements.happyTime not available")}async unlockImpl(e){a.createText("achievements.unlock not available")}async getScoreImpl(e){return a.createText("achievements.getScore not available"),0}async setScoreImpl(e,t){a.createText("achievements.setScore not available")}async getLeaderboardImpl(e){return a.createText("achievements.getLeaderboard not available"),new I}}}static{this.Platform=class extends x{async getAppIdImpl(){return""}async shareGameImpl(e){a.createText("platform.shareGame not available")}async rateGameImpl(){a.createText("platform.rateGame not available")}}}};var F=class s{static async createInstance(e){s.settings=e;let t=new s;try{window.GD_OPTIONS={gameId:s.settings.gameId,advertisementSettings:{debug:s.settings.adsDebug,autoplay:s.settings.adsAutoplay,locale:s.settings.adsLocale},onEvent:i=>{switch(i.name){case"SDK_READY":{a.createText("sdk is ready");break}case"LOADED":{a.createText("ad is loaded");break}case"CONTENT_PAUSE_REQUESTED":{a.createText("content pause requested");break}case"CONTENT_RESUME_REQUESTED":{a.createText("content resume requested");break}case"SDK_REWARDED_WATCH_COMPLETE":{a.createText("rewarded success"),t.ads?.onRewardedSuccess.invoke();break}case"SDK_ERROR":{a.createText("sdk error");break}}}},document.getElementById("gamedistribution-jssdk")||await p.createScriptAsync("https://html5.api.gamedistribution.com/main.min.js","gamedistribution-jssdk");let r=window.gdsdk;t.ads=await o.createInstance(s.Ads,r)}catch(r){a.createError(r)}return t}static{this.Ads=class extends d{constructor(t){super();this.onRewardedSuccess=new m;this.SDK=t}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){throw new Error("not implemented")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){throw new Error("not implemented")}async preloadInterstitial(){try{await this.SDK.preloadAd(this.SDK.AdType.Interstitial),a.createText("interstitial preloaded")}catch(t){a.createError(t)}}async invokeInterstitialImpl(){await this.preloadInterstitial(),this.onInterstitialOpen.invoke(),await this.SDK.showAd(this.SDK.AdType.Interstitial),this.onInterstitialClose.invoke(!0)}async preloadRewarded(){try{await this.SDK.preloadAd(this.SDK.AdType.Rewarded),a.createText("rewarded preloaded")}catch(t){a.createError(t)}}async invokeRewardedImpl(){let t=!1;this.onRewardedSuccess.clear(!0),this.onRewardedSuccess.add(()=>{t=!0},!0),await this.preloadRewarded(),this.onRewardedOpen.invoke(),await this.SDK.showAd(this.SDK.AdType.Rewarded),this.onRewardedClose.invoke(t)}}}};var A=class{constructor(e,t,r){this.tag=e,this.price=t,this.currency=r}};var E=class extends f{constructor(t,r,i){super();this.appId=t;this.userId=r;this.platform=i;this.initUrl="https://mirrasdk.ru/api/cloud-save/v1/init";this.saveUrl="https://mirrasdk.ru/api/cloud-save/v1/save";this.loadUrl="https://mirrasdk.ru/api/cloud-save/v1/load"}async initialize(){let t={AppId:this.appId,UserId:this.userId,Platform:this.platform},r=await this.sendPostRequestWithResponse(this.initUrl,t);console.log("cloud data",r.data),await super.initialize()}async readServerJson(){a.createText("read server json");let t={AppId:this.appId,UserId:this.userId};return(await this.sendPostRequestWithResponse(this.loadUrl,t)).data}async writeServerJson(t){a.createText("write server json");let r={AppId:this.appId,UserId:this.userId,Data:t};await this.sendPostRequest(this.saveUrl,r)}async sendPostRequest(t,r){a.createText("post request");let i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});i.ok||a.createError("post error",i.statusText)}async sendPostRequestWithResponse(t,r){a.createText("post request with response");let i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return i.ok||a.createError("post error",i.statusText),i.json()}};var U=class s{static{this.callbackListeners=[]}static addCallbackListener(e){s.callbackListeners.push(e)}static initializeFAPI(){let e=window.FAPI;return new Promise((t,r)=>{let i=e.Util.getRequestParameters();e.init(i.api_server,i.apiconnection,()=>{t()},n=>{r(n)})})}static async createInstance(e){s.settings=e;let t=new s;try{await p.createScriptAsync("//api.ok.ru/js/fapi5.js");let r=window.FAPI;if(window.API_callback=(i,n,l)=>{a.createText("api callback",i,n,l),i==="loadAd"?l==="ready"&&(r.UI.showLoadedAd(),t.ads?.onRewardedOpen.invoke()):i==="showLoadedAd"?l==="complete"&&t.ads?.onRewardedClose.invoke(!0):i==="showAd"&&(l.includes("ad_started")?t.ads?.onInterstitialOpen.invoke():l.includes("ad_shown")&&t.ads?.onInterstitialClose.invoke(!0)),s.callbackListeners.forEach(u=>{try{u(i,n,l)}catch(y){a.createError(y)}})},await s.initializeFAPI(),t.ads=await o.createInstance(s.Ads,r),t.player=await o.createInstance(s.Player,r),t.language=await o.createInstance(s.Language),e.extraArgs.includes("MirraHub")){let i=r.Util.getRequestParameters(),n=i.application_key,l=i.logged_user_id;t.data=await o.createInstance(E,n,l,"OK"),t.payments=await o.createInstance(s.Payments,r)}}catch(r){a.createError(r)}return t}static{this.Ads=class extends d{constructor(e){super(),this.FAPI=e}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){this.FAPI.invokeUIMethod("requestBannerAds"),this.onBannerOpen.invoke()}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){this.FAPI.invokeUIMethod("hideBannerAds"),this.onBannerClose.invoke()}async invokeInterstitialImpl(){this.FAPI.UI.showAd()}async invokeRewardedImpl(){this.FAPI.UI.loadAd()}}}static{this.Player=class extends g{constructor(e){super(),this.FAPI=e}async updatePlayerInfo(){try{let e=this.FAPI.Util.getRequestParameters();this.displayName=e.user_name,this.uniqueId=e.logged_user_id,this.isLoggedIn=!0}catch(e){a.createError(e)}}async tryLoginPlayer(){a.createError("not implemented")}}}static{this.Payments=class extends S{static{this.apiUrl="https://mirrasdk.ru/api/payments/ok"}constructor(e){super(),this.SDK=e;let t=e.Util.getRequestParameters();this.appId=t.application_key,this.userId=t.logged_user_id}async initialize(){await super.initialize(),s.addCallbackListener((e,t,r)=>{e==="showPayment"&&(t==="ok"?(a.createText("purchase success",r),this.onPurchaseSuccess.invoke()):(a.createError("purchase error",r),this.onPurchaseError.invoke()))})}async getProductsFromServer(){try{let e=await fetch(`${s.Payments.apiUrl}/get-product-details?appId=${this.appId}`);e.ok||a.createError("getServerProducts",e.statusText);let t=await e.json(),r=[];for(let i of t){let n=new A(i.productCode,parseFloat(i.price),"OK");r.push(n)}return r}catch(e){return a.createError(e),[]}}async getPurchasesFromServer(){try{let e=await fetch(`${s.Payments.apiUrl}/get-user-purchases?appId=${encodeURIComponent(this.appId)}&userId=${encodeURIComponent(this.userId)}`);e.ok||a.createError("getUserPurchases",e.statusText);let t=await e.json(),r=[];for(let i of t)r.push(i);return r}catch(e){return a.createError(e),[]}}async purchase(e,t,r){super.purchase(e,t,r);try{let n=await(await fetch(`https://mirrasdk.ru/api/payments/items/get-item-details?appId=${this.appId}&productCode=${e}`)).json();this.SDK.UI.showPayment(n.titile,n.titile,e,parseFloat(n.price),null,null,null,!0,null)}catch(i){this.onPurchaseError.invoke(i)}}}}static{this.Language=class extends b{async getCurrent(){return 1}}}};var M=class s{static async createInstance(e){s.settings=e;let t=new s;try{t.ads=await o.createInstance(s.Ads),t.analytics=await o.createInstance(s.Analytics),t.data=await o.createInstance(s.Data),t.player=await o.createInstance(s.Player)}catch(r){a.createError(r)}return t}static{this.Ads=class extends d{async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0,window.addEventListener("message",e=>{let t=e.playDeck;t&&(t.method==="rewardedAd"&&(a.createText("rewardedAd",t.value),this.onRewardedClose.invoke(!0)),t.method==="errAd"&&a.createText("errAd",t.value),t.method==="skipAd"&&(a.createText("skipAd",t.value),this.onRewardedClose.invoke(!1)),t.method==="notFoundAd"&&(a.createText("errAd",t.value),this.onRewardedClose.invoke(!1)),t.method==="startAd"&&(a.createText("startAd",t.value),this.onRewardedOpen.invoke()))})}async invokeBannerImpl(){throw new Error("not implemented")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){throw new Error("not implemented")}async invokeInterstitialImpl(){throw new Error("not implemented")}async invokeRewardedImpl(){parent.postMessage({playdeck:{method:"showAd"}},"*")}}}static{this.Analytics=class extends h{gameIsReadyImpl(){parent.postMessage({playdeck:{method:"loading",value:100}},"*")}gameplayStartImpl(e){a.createText("not available")}gameplayRestartImpl(e){a.createText("not available")}gameplayStopImpl(e){a.createText("not available")}}}static{this.Data=class extends f{constructor(){super(...arguments);this.pendingResolve=null}static{this.jsonKey="json-data"}async initialize(){window.addEventListener("message",t=>{let r=t.playDeck;if(r&&r.method==="getData"){a.createText("getData",r.value);let i=r.value?.data||"{}";this.pendingResolve&&(this.pendingResolve(i),this.pendingResolve=null)}})}async readServerJson(){try{return await new Promise((r,i)=>{this.pendingResolve=r,parent.postMessage({playdeck:{method:"getData",key:s.Data.jsonKey}},"*"),setTimeout(()=>{this.pendingResolve&&(this.pendingResolve=null,i(new Error("timeout waiting for response")))},5e3)})}catch(t){return a.createError(t),"{}"}}async writeServerJson(t){try{parent.postMessage({playdeck:{method:"setData",key:s.Data.jsonKey,value:t}},"*")}catch(r){a.createError(r)}}}}static{this.Player=class extends g{async initialize(){window.addEventListener("message",e=>{let t=e.playDeck;t&&t.method==="getUserProfile"&&a.createText("getUserProfile",t.value)})}async updatePlayerInfo(){try{a.createError("not implemented")}catch(e){a.createError(e)}}async tryLoginPlayer(){try{a.createError("not implemented")}catch(e){throw e}}}}};var W=class s{static async createInstance(e){s.settings=e;let t=new s;try{await p.createScriptAsync("https://game-cdn.poki.com/scripts/v2/poki-sdk.js"),t.SDK=window.PokiSDK,await t.SDK.init(),t.ads=await o.createInstance(s.Ads,t.SDK),t.analytics=await o.createInstance(s.Analytics,t.SDK)}catch(r){a.createError(r)}return t}static{this.Ads=class extends d{constructor(e){super(),this.SDK=e}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){throw new Error("not implemented")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){throw new Error("not implemented")}async invokeInterstitialImpl(){await this.SDK.commercialBreak(()=>{this.onInterstitialOpen.invoke()}),this.onInterstitialClose.invoke(!0)}async invokeRewardedImpl(){await this.SDK.rewardedBreak(()=>{this.onRewardedOpen.invoke()})?this.onRewardedClose.invoke(!0):this.onRewardedClose.invoke(!1)}}}static{this.Analytics=class extends h{constructor(e){super(),this.SDK=e}gameIsReadyImpl(){this.SDK.gameLoadingFinished()}gameplayStartImpl(e){this.SDK.gameplayStart()}gameplayRestartImpl(e){a.createText("not available")}gameplayStopImpl(e){this.SDK.gameplayStop()}}}};var z=class{constructor(){this.displayName="";this.position=0;this.score=0;this.profilePictureUrl=""}};var V=class s{static async createInstance(e){s.settings=e;let t=new s;try{let r=s.getSdkUrl();await p.createScriptAsync(r),t.SDK=await window.YaGames.init(),t.achievements=await o.createInstance(s.Achivements,t.SDK),t.ads=await o.createInstance(s.Ads,t.SDK),t.analytics=await o.createInstance(s.Analytics,t.SDK),t.data=await o.createInstance(s.Data,t.SDK),t.flags=await o.createInstance(s.Flags,t.SDK),t.language=await o.createInstance(s.Language,t.SDK),t.payments=await o.createInstance(s.Payments,t.SDK),t.player=await o.createInstance(s.Player,t.SDK),t.platform=await o.createInstance(s.Platform,t.SDK)}catch(r){a.createError(r)}return t}static getSdkUrl(){if(typeof window>"u")return"/sdk.js";try{let t=new URL(window.location.href).searchParams.get("sdk_origin");return!t||t.trim()===""?"/sdk.js":`//${t}/sdk.js`}catch{return"/sdk.js"}}static{this.Achivements=class extends w{constructor(e){super(),this.SDK=e}async happyTimeImpl(){throw new Error("not implemented")}async unlockImpl(e){throw new Error("not implemented")}async getScoreImpl(e){let t=await this.SDK.leaderboards.getPlayerEntry(e);return parseFloat(t.score)}async setScoreImpl(e,t){await this.SDK.leaderboards.setScore(e,t)}async getLeaderboardImpl(e){let r=(await this.SDK.leaderboards.getEntries(e,{quantityTop:50})).entries;a.createText("leaderboard entries",r);let i=new I;for(let n=0;n<r.length;n++){let l=new z;l.displayName=r[n].player.publicName,l.position=parseFloat(r[n].rank),l.score=parseFloat(r[n].score),l.profilePictureUrl=await r[n].player.getAvatarSrc(),i.players.push(l)}return a.createText("leaderboard object",i),i}}}static{this.Ads=class extends d{constructor(e){super(),this.SDK=e}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isBannerAvailable=!0,await this.updateBannerStatus(),this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async updateBannerStatus(){a.createText("updateBannerStatus");try{let{stickyAdvIsShowing:e,reason:t}=await this.SDK.adv.getBannerAdvStatus();this.isBannerVisible=e,e?this.isBannerReady=!1:t?(this.isBannerReady=!1,a.createError("getBannerStatus",t)):this.isBannerReady=!0}catch(e){a.createError("getBannerStatus",e)}}async invokeBannerImpl(){await this.updateBannerStatus(),this.isBannerReady?this.SDK.adv.showBannerAdv().then(()=>{this.isBannerVisible=!0}):this.onBannerError.invoke("banner not ready")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){await this.updateBannerStatus(),this.isBannerVisible?this.SDK.adv.hideBannerAdv().then(()=>{this.isBannerVisible=!1}):this.onBannerError.invoke("banner not visible")}async invokeInterstitialImpl(){this.SDK.adv.showFullscreenAdv({callbacks:{onOpen:()=>{this.onInterstitialOpen.invoke()},onClose:e=>{this.onInterstitialClose.invoke(e)},onError:e=>{this.onInterstitialError.invoke(e)},onOffline:()=>{}}})}async invokeRewardedImpl(){let e=!1;this.SDK.adv.showRewardedVideo({callbacks:{onOpen:()=>{this.onRewardedOpen.invoke()},onRewarded:()=>{e=!0},onClose:()=>{this.onRewardedClose.invoke(e)},onError:t=>{this.onRewardedError.invoke(t)}}})}}}static{this.Analytics=class extends h{constructor(e){super(),this.SDK=e}gameIsReadyImpl(){this.SDK.features.LoadingAPI?.ready()}gameplayStartImpl(e){this.SDK.features.GameplayAPI?.start()}gameplayRestartImpl(e){a.createText("not available")}gameplayStopImpl(e){this.SDK.features.GameplayAPI?.stop()}}}static{this.Data=class extends f{static{this.jsonKey="json-data"}constructor(e){super(),this.SDK=e}async readServerJson(){try{return(await(await this.SDK.getPlayer()).getData([s.Data.jsonKey]))[s.Data.jsonKey]}catch(e){return a.createError(e),"{}"}}async writeServerJson(e){try{let t=await this.SDK.getPlayer(),r={[s.Data.jsonKey]:e};await t.setData(r,!0)}catch(t){a.createError(t)}}}}static{this.Flags=class extends R{constructor(e){super(),this.SDK=e}async readServerJson(){try{let e=await this.SDK.getFlags();return JSON.stringify(e)}catch(e){return a.createError(e),"{}"}}}}static{this.Language=class extends b{constructor(e){super(),this.SDK=e}async getCurrent(){try{switch(this.SDK.environment.i18n.lang){case"en":return 0;case"ru":return 1;case"ja":return 2;case"zh":return 3;case"tr":return 4;case"hi":return 5;case"ko":return 6;case"pt":return 7;case"id":return 8;case"de":return 9;case"es":return 10;case"it":return 11;case"uk":return 12;case"pl":return 13;case"fr":return 14;case"da":return 15;case"cs":return 16;case"af":return 17;case"is":return 18;case"no":return 19;case"sv":return 20;case"nl":return 21;case"sk":return 22;case"th":return 23;case"vi":return 24;default:return 0}}catch(e){return a.createError(e),0}}}}static{this.Payments=class extends S{constructor(e){super(),this.SDK=e}async getProductsFromServer(){try{let e=await this.SDK.getPayments(),t=[],r=await e.getCatalog();for(let i of r){let n=new A(i.id,parseFloat(i.price),i.priceCurrencyCode);t.push(n)}return t}catch(e){return a.createError(e),[]}}async getPurchasesFromServer(){try{let e=await this.SDK.getPayments(),t=[],r=await e.getPurchases();for(let i of r)t.push(i.productID);return t}catch(e){return a.createError(e),[]}}async purchase(e,t,r){super.purchase(e,t,r);try{await(await this.SDK.getPayments()).purchase(e),this.onPurchaseSuccess.invoke()}catch(i){this.onPurchaseError.invoke(i)}}}}static{this.Platform=class extends x{constructor(e){super(),this.SDK=e}async getAppIdImpl(){return this.SDK.environment.app.id}async shareGameImpl(e){throw new Error("not implemented")}async rateGameImpl(){let e=await this.SDK.feedback.canReview();if(e.value){let t=await this.SDK.feedback.requestReview();a.createText("rate game success",t.data)}else throw new Error(e.reason)}}}static{this.Player=class extends g{constructor(e){super(),this.SDK=e}async updatePlayerInfo(){try{let e=await this.SDK.getPlayer();this.displayName=e.getName(),this.uniqueId=e.getUniqueID(),this.isLoggedIn=e.isAuthorized()}catch(e){a.createError(e)}}async tryLoginPlayer(){try{await this.SDK.auth.openAuthDialog()}catch(e){throw e}}}}};var N=class s{static async createInstance(e){s.settings=e;let t=new s;try{await p.createScriptAsync("https://lagged.com/api/rev-share/lagged.js"),t.SDK=window.LaggedAPI,t.SDK.init(e.devId,e.publisherId),t.ads=await o.createInstance(s.Ads,t.SDK),t.player=await o.createInstance(s.Player,t.SDK),t.achievements=await o.createInstance(s.Achievements,t.SDK)}catch(r){a.createError(r)}return t}static{this.Ads=class extends d{constructor(e){super(),this.SDK=e}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){throw new Error("not implemented")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){throw new Error("not implemented")}async invokeInterstitialImpl(){this.onInterstitialOpen.invoke(),this.SDK.APIAds.show(()=>{this.onInterstitialClose.invoke(!0)})}async invokeRewardedImpl(){let e=(r,i)=>{r?(this.onRewardedOpen.invoke(),i()):this.onRewardedClose.invoke(!1)},t=r=>{this.onRewardedClose.invoke(r)};this.SDK.GEvents.reward(e,t)}}}static{this.Player=class extends g{constructor(e){super(),this.SDK=e}async updatePlayerInfo(){try{let e=await new Promise(t=>{this.SDK.User.get(r=>{t(r)})});if(a.createText("updatePlayerInfo",e),!e||!e.user)return;this.displayName=e.user.name.toString(),this.uniqueId=e.user.id.toString(),this.isLoggedIn=!0}catch(e){a.createError(e)}}async tryLoginPlayer(){try{a.createError("not implemented")}catch(e){throw e}}}}static{this.Achievements=class extends w{constructor(e){super(),this.SDK=e}async happyTimeImpl(){throw new Error("not implemented")}async unlockImpl(e){let t=[];t.push(e),this.SDK.Achievements.save(t,r=>{r.success?a.createText("unlock success"):a.createError("unlock",r.errormsg)})}async getScoreImpl(e){throw new Error("not implemented")}async setScoreImpl(e,t){let r={};r.score=t,r.board=e,this.SDK.Scores.save(r,i=>{i.success?a.createText("setScore success"):a.createError("setScore",i.errormsg)})}async getLeaderboardImpl(e){throw new Error("not implemented")}}}};var q=class s extends d{static{this.isAvailable=!1}constructor(e){super(),s.settings=e}async initialize(){if(!s.settings)throw new Error("invalid adsense settings");let e=s.settings.dataAdClient.replace(/\s+/g,""),t=s.settings.dataAdChannel.replace(/\s+/g,"");if(e==""||t=="")throw new Error("invalid adsense settings: "+JSON.stringify(s.settings));let r=document.createElement("script");r.setAttribute("data-ad-client",e),r.setAttribute("data-ad-channel",t),s.settings.dataAdBreakTest==!0&&r.setAttribute("data-adbreak-test","on"),r.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",r.setAttribute("type","text/javascript"),r.async=!0,r.onload=()=>{a.createText("adSense script loaded"),s.isAvailable=!0},r.onerror=n=>{a.createError("adSense script error",n)},document.head.appendChild(r);let i=window;i.adsbygoogle=i.adsbygoogle||[],i.adBreak=i.adConfig=function(n){i.adsbygoogle.push(n)},i.adConfig({preloadAdBreaks:"on",sound:"on",sandbox:"allow-scripts allow-same-origin allow-forms",onReady:()=>{a.createText("adSense ready"),s.isAvailable=!0}}),this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){a.createText("banner not available")}async refreshBannerImpl(){a.createText("banner not available")}async disableBannerImpl(){a.createText("banner not available")}async invokeInterstitialImpl(){if(!s.isAvailable){a.createText("adSense not available"),this.onInterstitialClose.invoke(!1);return}window.adBreak({type:"next",name:"next-game",beforeAd:()=>{a.createText("beforeAd"),this.onInterstitialOpen.invoke()},afterAd:()=>{a.createText("afterAd"),this.onInterstitialClose.invoke(!0)},adBreakDone:e=>{a.createText("adBreak complete"),a.createText(e.breakType),a.createText(e.breakName),a.createText(e.breakFormat),a.createText(e.breakStatus),(e.breakStatus=="frequencyCapped"||e.breakStatus=="other")&&this.onInterstitialClose.invoke(!1)}})}async invokeRewardedImpl(){if(!s.isAvailable){a.createText("adSense not available"),this.onRewardedClose.invoke(!0);return}window.adBreak({type:"reward",name:"rewarded Ad",beforeAd:()=>{a.createText("beforeAd"),this.onRewardedOpen.invoke()},afterAd:()=>{a.createText("afterAd")},beforeReward:e=>{a.createText("beforeReward "+e(0))},adDismissed:()=>{a.createText("adDismissed"),this.onRewardedClose.invoke(!1)},adViewed:()=>{a.createText("adViewed"),this.onRewardedClose.invoke(!0)},adBreakDone:e=>{a.createText("adBreak complete"),a.createText(e.breakType),a.createText(e.breakName),a.createText(e.breakFormat),a.createText(e.breakStatus),(e.breakStatus=="frequencyCapped"||e.breakStatus=="other")&&this.onRewardedClose.invoke(!0)}})}};var J=class s{static async createInstance(e){let t=new s;try{t.ads=await o.createInstance(q,e.adSense)}catch(r){a.createError(r)}return t}};var Y=class s{static async createInstance(e){s.settings=e;let t=new s;try{await p.createScriptAsync("https://integration.gamepix.com/sdk/v3/gamepix.sdk.js"),t.SDK=window.GamePix,t.achievements=await o.createInstance(s.Achievements,t.SDK),t.analytics=await o.createInstance(s.Analytics,t.SDK),t.ads=await o.createInstance(s.Ads,t.SDK),t.data=await o.createInstance(s.Data,t.SDK),t.language=await o.createInstance(s.Language,t.SDK)}catch(r){a.createError(r)}return t}static{this.Achievements=class extends w{constructor(e){super(),this.SDK=e}async happyTimeImpl(){this.SDK.happyMoment()}async unlockImpl(e){throw new Error("not implemented")}async getScoreImpl(e){throw new Error("not implemented")}async setScoreImpl(e,t){this.SDK.updateScore(t)}async getLeaderboardImpl(e){throw new Error("not implemented")}}}static{this.Ads=class extends d{constructor(e){super(),this.SDK=e}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){throw new Error("not implemented")}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){throw new Error("not implemented")}async invokeInterstitialImpl(){this.onInterstitialOpen.invoke();let e=await this.SDK.interstitialAd();e.success?(a.createText("interstitial success"),this.onInterstitialClose.invoke(!0)):(a.createError("interstitial error",e),this.onInterstitialClose.invoke(!1))}async invokeRewardedImpl(){this.onRewardedOpen.invoke();let e=await this.SDK.rewardAd();e.success?(a.createText("rewarded success"),this.onRewardedClose.invoke(!0)):(a.createError("rewarded error",e),this.onRewardedClose.invoke(!1))}}}static{this.Analytics=class extends h{constructor(e){super(),this.SDK=e}gameIsReadyImpl(){a.createText("not available")}gameplayStartImpl(e){this.SDK.updateLevel(e)}gameplayRestartImpl(e){this.SDK.updateLevel(e)}gameplayStopImpl(e){a.createText("not available")}}}static{this.Data=class extends f{static{this.jsonKey="json-data"}constructor(e){super(),this.SDK=e}async readServerJson(){try{return await this.SDK.localStorage.getItem(s.Data.jsonKey)||"{}"}catch(e){return a.createError(e),"{}"}}async writeServerJson(e){try{this.SDK.localStorage.setItem(s.Data.jsonKey,e)}catch(t){a.createError(t)}}}}static{this.Language=class extends b{constructor(e){super(),this.SDK=e}async getCurrent(){try{switch(this.SDK.lang()){case"en":return 0;case"ru":return 1;case"ja":return 2;case"zh":return 3;case"tr":return 4;case"hi":return 5;case"ko":return 6;case"pt":return 7;case"id":return 8;case"de":return 9;case"es":return 10;case"it":return 11;case"uk":return 12;case"pl":return 13;case"fr":return 14;case"da":return 15;case"cs":return 16;case"af":return 17;case"is":return 18;case"no":return 19;case"sv":return 20;case"nl":return 21;case"sk":return 22;case"th":return 23;case"vi":return 24;default:return 0}}catch(e){return a.createError(e),0}}}}};var H=class s{static async createInstance(e){s.settings=e;let t=new s;try{await p.createScriptAsync("https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"),t.bridge=window.vkBridge;let r=await t.bridge.send("VKWebAppInit");a.createText("VKWebAppInit",r),t.ads=await o.createInstance(s.Ads,t.bridge),t.player=await o.createInstance(s.Player,t.bridge),t.platform=await o.createInstance(s.Platform,t.bridge),t.achievements=await o.createInstance(s.Achievements,t.bridge),t.language=await o.createInstance(s.Language),s.userId=t.player.uniqueId,e.extraArgs.includes("MirraHub")&&(t.data=await o.createInstance(E,e.appId,s.userId,"VK"),t.payments=await o.createInstance(s.Payments,t.bridge))}catch(r){a.createError(r)}return t}static{this.Achievements=class extends w{constructor(e){super(),this.bridge=e}async happyTimeImpl(){a.createText("not available")}async unlockImpl(e){a.createText("not available")}async getScoreImpl(e){return a.createText("not available"),0}async setScoreImpl(e,t){await this.bridge.send("VKWebAppShowLeaderBoardBox",{user_result:t})}async getLeaderboardImpl(e){return a.createText("not available"),new I}}}static{this.Ads=class extends d{constructor(e){super(),this.bridge=e}async initialize(){this.interstitialIntervalSeconds=s.settings.interstitialIntervalSeconds,this.isInterstitialAvailable=!0,this.isInterstitialReady=!0,this.isRewardedAvailable=!0,this.isRewardedReady=!0}async invokeBannerImpl(){let e=await this.bridge.send("VKWebAppShowBannerAd",{banner_location:"bottom"});a.createText("VKWebAppShowBannerAd",e),e.result&&this.onBannerOpen.invoke()}async refreshBannerImpl(){throw new Error("not implemented")}async disableBannerImpl(){let e=await this.bridge.send("VKWebAppHideBannerAd");a.createText("VKWebAppHideBannerAd",e),e.result&&this.onBannerClose.invoke()}async invokeInterstitialImpl(){await this.bridge.send("VKWebAppCheckNativeAds",{ad_format:"interstitial"}),this.onInterstitialOpen.invoke(),await this.bridge.send("VKWebAppShowNativeAds",{ad_format:"interstitial"}),this.onInterstitialClose.invoke(!0)}async invokeRewardedImpl(){await this.bridge.send("VKWebAppCheckNativeAds",{ad_format:"reward"}),this.onRewardedOpen.invoke();let e=await this.bridge.send("VKWebAppShowNativeAds",{ad_format:"reward"}),t=!1;e.result&&(t=!0),this.onRewardedClose.invoke(t)}}}static{this.Player=class extends g{constructor(e){super(),this.bridge=e}async updatePlayerInfo(){try{let e=await this.bridge.send("VKWebAppGetUserInfo");a.createText("VKWebAppGetUserInfo",e),this.firstName=e.first_name,this.lastName=e.last_name,this.uniqueId=e.id.toString(),this.displayName=e.first_name+" "+e.last_name,this.isLoggedIn=!0}catch(e){a.createError(e)}}async tryLoginPlayer(){a.createText("not available")}}}static{this.Platform=class extends x{constructor(e){super(),this.bridge=e}async getAppIdImpl(){return s.settings.appId}async shareGameImpl(e){let t="https://vk.com/app"+s.settings.appId;await this.bridge.send("VKWebAppShare",{link:t,message:e})}async rateGameImpl(){await this.bridge.send("VKWebAppRecommend")}}}static{this.Payments=class extends S{static{this.apiUrl="https://mirrasdk.ru/api/payments/vk"}constructor(e){super(),this.bridge=e}async getProductsFromServer(){try{let e=await fetch(`${s.Payments.apiUrl}/get-product-details?appId=${s.settings.appId}`);e.ok||a.createError("getServerProducts",e.statusText);let t=await e.json(),r=this.getBrowserLanguage(),i=[];for(let n of t){let l=new A(n.productCode,parseFloat(n.price),this.getLocalizedVoteString(n.price,r));i.push(l)}return i}catch(e){return a.createError(e),[]}}async getPurchasesFromServer(){try{let e=await fetch(`${s.Payments.apiUrl}/get-user-purchases?appId=${encodeURIComponent(s.settings.appId)}&userId=${encodeURIComponent(s.userId)}`);e.ok||a.createError("getUserPurchases",e.statusText);let t=await e.json(),r=[];for(let i of t)r.push(i);return r}catch(e){return a.createError(e),[]}}async purchase(e,t,r){super.purchase(e,t,r);try{let i=await this.bridge.send("VKWebAppShowOrderBox",{type:"item",item:e});i?.success===!0?this.onPurchaseSuccess.invoke():this.onPurchaseError.invoke(i.error_data)}catch(i){this.onPurchaseError.invoke(i)}}getBrowserLanguage(){return"ru"}getLocalizedVoteString(e,t){if(typeof e!="number"||!Number.isInteger(e)||e<0)return a.createError("invalid price",e.toString()),"";if(t!=="ru"&&t!=="en")return a.createError("invalid language"),"";if(t==="en")return e===1?"Vote":"Votes";if(t==="ru"){let r=e%10,i=e%100;return i>=11&&i<=14?"\u0413\u043E\u043B\u043E\u0441\u043E\u0432":r===1?"\u0413\u043E\u043B\u043E\u0441":r>=2&&r<=4?"\u0413\u043E\u043B\u043E\u0441\u0430":"\u0413\u043E\u043B\u043E\u0441\u043E\u0432"}return a.createError("invalid language",t),""}}}static{this.Language=class extends b{async getCurrent(){return 1}}}};var D=class s{static detectPlatform(){if(typeof window>"u")return a.createError("window is not defined"),"Unknown";try{let e="Unknown";document.referrer&&(e=s.platformFromUrl(document.referrer));let t="Unknown";return window.location.href&&(t=s.platformFromUrl(window.location.href)),a.createText("window is",t,"referrer is",e),e!=="Unknown"&&e!=="MirraHub"&&e!=="Localhost"?e:t}catch(e){return a.createError(e),"Unknown"}}static platformFromUrl(e){try{let t=new URL(e),r=t.hostname,i=t.hash,n=t.searchParams;return r.includes("localhost")||r.includes("127.0.0.1")||r.includes("[::1]")?"Localhost":r.includes("crazygames.com")?"CrazyGames":r.includes("gamedistribution.com")?"GameDistribution":r.includes("poki.com")||r.includes("poki-gdn.com")||n.has("pokiDebug")?"Poki":r.includes("y8.com")?"Y8":r.includes(["games.","s3.","yandex.","net"].join(""))||i.includes("app-id=")||n.has("app-id")?"YandexGames":r.includes("ok.ru")?"OK":r.includes("vk.com")?"VK":r.includes("playdeck.io")?"PlayDeck":r.includes("telegram.org")?"Telegram":r.includes("coolmathgames.com")?"CoolMath":r.includes("lagged.")?"Lagged":r.includes("zygomaticgames.com")?"Zygomatic":r.includes("msn.")||r.includes("start.gg")?"MSN":r.includes("gamepix.")?"GamePix":r.includes("mirrahub.")?"MirraHub":"Unknown"}catch(t){return a.createError(t),"Unknown"}}static async getWrapper(e,t){switch(e){case"GameDistribution":return await F.createInstance(t.gameDistribution);case"CrazyGames":return await j.createInstance(t.crazyGames);case"Poki":return await W.createInstance(t.poki);case"Lagged":return await N.createInstance(t.lagged);case"YandexGames":return await V.createInstance(t.yandexGames);case"Y8":return await J.createInstance(t.y8);case"CoolMath":return await B.createInstance(t.coolMath);case"VK":return await H.createInstance(t.vk);case"OK":return await U.createInstance(t.ok);case"PlayDeck":return await M.createInstance(t.playDeck);case"GamePix":return await Y.createInstance(t.gamePix);default:return await G.createInstance()}}};var $=class{constructor(){this.isPaused=!1;this.pauseSources=new Set;this.adsPauseSources=new Set;this.onPauseChange=new m;this.onAdsPauseChange=new m}async initialize(){}register(e,t){a.createText("register",e,t.toString());let r=e.toLowerCase().includes("interstitial")||e.toLowerCase().includes("rewarded"),i=this.isPaused,n=this.adsPauseSources.size>0;t?(this.pauseSources.add(e),r&&this.adsPauseSources.add(e)):(this.pauseSources.delete(e),r&&this.adsPauseSources.delete(e)),this.isPaused=this.pauseSources.size>0;let l=this.adsPauseSources.size>0;this.isPaused!==i&&this.onPauseChange.invoke(this.isPaused),l!==n&&this.onAdsPauseChange.invoke(l)}};var K=class s{static async createInstance(e){function t(u,y){let P={...u};for(let v in y)y[v]&&typeof y[v]=="object"&&!Array.isArray(y[v])?P[v]=t(u[v]||{},y[v]):P[v]=y[v];return P}let r=new C,i=t({...r},e||{});a.enableTextMessages=i.logger.enableTextMessages,a.enableWarningMessages=i.logger.enableWarningMessages,a.enableExceptionMessages=i.logger.enableExceptionMessages;let n=new s,l=D.detectPlatform();return a.createText("platform",l),s.pause=new $,a.createText("create: fallback providers"),n.fallback=await D.getWrapper("Unknown",i),l!=="Unknown"&&(a.createText("create: platform providers"),n.wrapper=await D.getWrapper(l,i)),n.achievements=n.wrapper?.achievements||n.fallback.achievements,n.ads=n.wrapper?.ads||n.fallback.ads,n.analytics=n.wrapper?.analytics||n.fallback.analytics,n.data=n.wrapper?.data||n.fallback.data,n.device=n.wrapper?.device||n.fallback.device,n.flags=n.wrapper?.flags||n.fallback.flags,n.language=n.wrapper?.language||n.fallback.language,n.payments=n.wrapper?.payments||n.fallback.payments,n.player=n.wrapper?.player||n.fallback.player,n.platform=n.wrapper?.platform||n.fallback.platform,a.createText("language",k[n.language.current]),n.ads.onInterstitialOpen.add(()=>{s.pause.register("interstitial",!0)}),n.ads.onInterstitialClose.add(()=>{s.pause.register("interstitial",!1)}),n.ads.onRewardedOpen.add(()=>{s.pause.register("rewarded",!0)}),n.ads.onRewardedClose.add(()=>{s.pause.register("rewarded",!1)}),typeof window<"u"&&(window.addEventListener("blur",()=>{s.pause.register("window.focus",!0)}),window.addEventListener("focus",()=>{s.pause.register("window.focus",!1)}),document.addEventListener("visibilitychange",()=>{s.pause.register("document.visibility",document.hidden)})),n}};Module.MirraSDK=K;Module.createMirraSDK=async s=>{Module.mirraSDK=await K.createInstance(s)};Module.waitForMirraSDK=async()=>Module.mirraSDK?Promise.resolve():new Promise(s=>{let e=setInterval(()=>{Module.mirraSDK&&(clearInterval(e),s())},100)});})();
